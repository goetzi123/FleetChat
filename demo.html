<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FleetChat Demo - Bidirectional Communication</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }
        @keyframes statusUpdate {
            from { background-color: #fef3c7; }
            to { background-color: #f0f9ff; }
        }
        .message-enter { animation: slideIn 0.4s ease-out; }
        .typing { animation: pulse 1.5s infinite; }
        .status-update { animation: statusUpdate 1s ease-out; }
        .event-button:hover { transform: translateY(-2px); }
        .event-button { transition: all 0.2s ease; }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Header -->
    <div class="bg-white shadow-sm border-b">
        <div class="max-w-7xl mx-auto px-4 py-6">
            <h1 class="text-3xl font-bold text-gray-900 text-center">FleetChat Demo</h1>
            <p class="text-lg text-gray-600 text-center mt-2">Bidirectional Communication: Samsara ‚Üî WhatsApp</p>
            <p class="text-sm text-gray-500 text-center mt-1">Real-time demonstration of intelligent fleet communication middleware</p>
        </div>
    </div>

    <!-- Main Demo Container -->
    <div class="max-w-7xl mx-auto px-4 py-8">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            
            <!-- Samsara Fleet Events Panel -->
            <div class="bg-white rounded-xl shadow-lg border border-gray-200">
                <div class="bg-blue-50 rounded-t-xl p-6 border-b border-blue-100">
                    <h2 class="text-2xl font-semibold text-blue-900 flex items-center">
                        <span class="text-3xl mr-3">üöõ</span>
                        Samsara Fleet Events
                    </h2>
                    <p class="text-blue-700 mt-2">Click events to trigger WhatsApp messages</p>
                </div>
                
                <div class="p-6 space-y-4">
                    <!-- Route Assignment -->
                    <button onclick="triggerEvent('route')" class="event-button w-full text-left p-4 bg-blue-50 border-2 border-blue-200 rounded-lg hover:bg-blue-100 hover:border-blue-300">
                        <div class="flex items-center">
                            <div class="w-12 h-12 bg-blue-500 text-white rounded-full flex items-center justify-center mr-4 text-xl">üöö</div>
                            <div class="flex-1">
                                <h3 class="font-semibold text-gray-900">Route Assignment</h3>
                                <p class="text-sm text-gray-600">Assign new delivery route to driver</p>
                            </div>
                        </div>
                    </button>
                    
                    <!-- Pickup Reminder -->
                    <button onclick="triggerEvent('pickup')" class="event-button w-full text-left p-4 bg-orange-50 border-2 border-orange-200 rounded-lg hover:bg-orange-100 hover:border-orange-300">
                        <div class="flex items-center">
                            <div class="w-12 h-12 bg-orange-500 text-white rounded-full flex items-center justify-center mr-4 text-xl">üìã</div>
                            <div class="flex-1">
                                <h3 class="font-semibold text-gray-900">Pickup Reminder</h3>
                                <p class="text-sm text-gray-600">Scheduled pickup time approaching</p>
                            </div>
                        </div>
                    </button>
                    
                    <!-- Arrival Notification -->
                    <button onclick="triggerEvent('arrival')" class="event-button w-full text-left p-4 bg-green-50 border-2 border-green-200 rounded-lg hover:bg-green-100 hover:border-green-300">
                        <div class="flex items-center">
                            <div class="w-12 h-12 bg-green-500 text-white rounded-full flex items-center justify-center mr-4 text-xl">üìç</div>
                            <div class="flex-1">
                                <h3 class="font-semibold text-gray-900">Arrival Notification</h3>
                                <p class="text-sm text-gray-600">Driver arrived at customer location</p>
                            </div>
                        </div>
                    </button>
                    
                    <!-- Document Collection -->
                    <button onclick="triggerEvent('document')" class="event-button w-full text-left p-4 bg-purple-50 border-2 border-purple-200 rounded-lg hover:bg-purple-100 hover:border-purple-300">
                        <div class="flex items-center">
                            <div class="w-12 h-12 bg-purple-500 text-white rounded-full flex items-center justify-center mr-4 text-xl">üìÑ</div>
                            <div class="flex-1">
                                <h3 class="font-semibold text-gray-900">Document Collection</h3>
                                <p class="text-sm text-gray-600">POD or delivery receipt required</p>
                            </div>
                        </div>
                    </button>
                    
                    <!-- HOS Warning -->
                    <button onclick="triggerEvent('hos')" class="event-button w-full text-left p-4 bg-red-50 border-2 border-red-200 rounded-lg hover:bg-red-100 hover:border-red-300">
                        <div class="flex items-center">
                            <div class="w-12 h-12 bg-red-500 text-white rounded-full flex items-center justify-center mr-4 text-xl">‚ö†Ô∏è</div>
                            <div class="flex-1">
                                <h3 class="font-semibold text-gray-900">HOS Warning</h3>
                                <p class="text-sm text-gray-600">Hours of service limit approaching</p>
                            </div>
                        </div>
                    </button>
                    
                    <!-- Geofence Entry -->
                    <button onclick="triggerEvent('geofence')" class="event-button w-full text-left p-4 bg-indigo-50 border-2 border-indigo-200 rounded-lg hover:bg-indigo-100 hover:border-indigo-300">
                        <div class="flex items-center">
                            <div class="w-12 h-12 bg-indigo-500 text-white rounded-full flex items-center justify-center mr-4 text-xl">üéØ</div>
                            <div class="flex-1">
                                <h3 class="font-semibold text-gray-900">Geofence Entry</h3>
                                <p class="text-sm text-gray-600">Vehicle entered designated area</p>
                            </div>
                        </div>
                    </button>
                </div>
                
                <!-- Samsara Status Panel -->
                <div class="bg-gray-50 rounded-b-xl p-6 border-t border-gray-200">
                    <h3 class="font-semibold text-gray-900 mb-3">System Status</h3>
                    <div id="samsara-status" class="space-y-2">
                        <div class="text-sm text-gray-600">Ready to process events...</div>
                    </div>
                </div>
            </div>
            
            <!-- WhatsApp Driver Interface Panel -->
            <div class="bg-white rounded-xl shadow-lg border border-gray-200">
                <div class="bg-green-50 rounded-t-xl p-6 border-b border-green-100">
                    <h2 class="text-2xl font-semibold text-green-900 flex items-center">
                        <span class="text-3xl mr-3">üí¨</span>
                        Driver WhatsApp
                    </h2>
                    <p class="text-green-700 mt-2">Messages appear automatically from fleet events</p>
                </div>
                
                <!-- WhatsApp Conversation -->
                <div class="h-96 overflow-y-auto p-6 bg-green-25" style="background-image: url('data:image/svg+xml,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 100 100\"><defs><pattern id=\"whatsapp\" x=\"0\" y=\"0\" width=\"100\" height=\"100\" patternUnits=\"userSpaceOnUse\"><circle cx=\"50\" cy=\"50\" r=\"2\" fill=\"%23e0f2fe\" opacity=\"0.1\"/></pattern></defs><rect width=\"100\" height=\"100\" fill=\"url(%23whatsapp)\"/></svg>');">
                    <div id="whatsapp-messages" class="space-y-4">
                        <div class="text-center text-gray-500 text-sm py-8">
                            FleetChat messages will appear here when you trigger Samsara events
                        </div>
                    </div>
                </div>
                
                <!-- Driver Response Actions -->
                <div class="bg-gray-50 rounded-b-xl p-6 border-t border-gray-200">
                    <h3 class="font-semibold text-gray-900 mb-3">Driver Response Options</h3>
                    <div id="response-options" class="space-y-2">
                        <div class="text-sm text-gray-600">Response options will appear when messages are received</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Clear Demo Button -->
        <div class="text-center mt-8">
            <button onclick="clearDemo()" class="px-6 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors">
                Clear Demo
            </button>
        </div>
    </div>

    <script>
        // Event data and messages
        const eventData = {
            route: {
                message: "New delivery route assigned: ACME Corp, 123 Industrial Blvd, Chicago IL. Please confirm receipt and estimated departure time.",
                responses: ["Confirm Route", "Need Navigation", "Report Delay"]
            },
            pickup: {
                message: "Pickup reminder: ACME Corp at 123 Industrial Blvd in 30 minutes. Need any navigation assistance?",
                responses: ["On My Way", "Send Location", "Running Late"]
            },
            arrival: {
                message: "Arrived at ACME Corp. Please share loading status and any delays.",
                responses: ["Loading Started", "Share Location", "Upload Photo"]
            },
            document: {
                message: "Please upload signed delivery receipt and any customer notes for ACME Corp delivery.",
                responses: ["Upload POD", "Add Notes", "Customer Signature"]
            },
            hos: {
                message: "HOS Alert: 1 hour remaining on duty. Plan for required rest period.",
                responses: ["Find Rest Area", "Extension Request", "Off Duty Soon"]
            },
            geofence: {
                message: "Entered Chicago Distribution Center. Please confirm your activity and estimated duration.",
                responses: ["Loading Activity", "Maintenance Stop", "Driver Break"]
            }
        };

        function triggerEvent(eventType) {
            const event = eventData[eventType];
            if (!event) return;

            // Update Samsara status
            updateSamsaraStatus(`Processing ${eventType} event...`);
            
            // Show typing indicator
            setTimeout(() => {
                showTypingIndicator();
            }, 500);
            
            // Send WhatsApp message
            setTimeout(() => {
                hideTypingIndicator();
                addWhatsAppMessage(event.message, 'fleet');
                showResponseOptions(event.responses, eventType);
            }, 2000);
            
            // Update Samsara status
            setTimeout(() => {
                updateSamsaraStatus(`Event sent to driver. Awaiting response...`);
            }, 2500);
        }

        function addWhatsAppMessage(message, sender) {
            const messagesContainer = document.getElementById('whatsapp-messages');
            
            // Clear placeholder if it exists
            if (messagesContainer.querySelector('.text-center')) {
                messagesContainer.innerHTML = '';
            }
            
            const messageDiv = document.createElement('div');
            messageDiv.className = `message-enter ${sender === 'fleet' ? 'ml-4' : 'mr-4'}`;
            
            messageDiv.innerHTML = `
                <div class="${sender === 'fleet' ? 'bg-blue-500 text-white ml-auto' : 'bg-white text-gray-900'} rounded-lg p-3 max-w-xs shadow-sm">
                    <div class="text-sm">${message}</div>
                    <div class="text-xs mt-1 ${sender === 'fleet' ? 'text-blue-100' : 'text-gray-500'}">${new Date().toLocaleTimeString()}</div>
                </div>
            `;
            
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function showTypingIndicator() {
            const messagesContainer = document.getElementById('whatsapp-messages');
            const typingDiv = document.createElement('div');
            typingDiv.id = 'typing-indicator';
            typingDiv.className = 'typing mr-4';
            typingDiv.innerHTML = `
                <div class="bg-gray-200 rounded-lg p-3 max-w-xs">
                    <div class="flex space-x-1">
                        <div class="w-2 h-2 bg-gray-500 rounded-full animate-pulse"></div>
                        <div class="w-2 h-2 bg-gray-500 rounded-full animate-pulse" style="animation-delay: 0.2s"></div>
                        <div class="w-2 h-2 bg-gray-500 rounded-full animate-pulse" style="animation-delay: 0.4s"></div>
                    </div>
                </div>
            `;
            messagesContainer.appendChild(typingDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function hideTypingIndicator() {
            const typingIndicator = document.getElementById('typing-indicator');
            if (typingIndicator) {
                typingIndicator.remove();
            }
        }

        function showResponseOptions(responses, eventType) {
            const optionsContainer = document.getElementById('response-options');
            optionsContainer.innerHTML = '';
            
            responses.forEach(response => {
                const button = document.createElement('button');
                button.className = 'w-full text-left p-3 bg-green-100 border border-green-200 rounded-lg hover:bg-green-200 transition-colors mb-2';
                button.textContent = response;
                button.onclick = () => sendDriverResponse(response, eventType);
                optionsContainer.appendChild(button);
            });
        }

        function sendDriverResponse(response, eventType) {
            // Add driver message to WhatsApp
            addWhatsAppMessage(response, 'driver');
            
            // Clear response options
            const optionsContainer = document.getElementById('response-options');
            optionsContainer.innerHTML = '<div class="text-sm text-gray-600">Response sent to FleetChat</div>';
            
            // Update Samsara with driver response
            setTimeout(() => {
                updateSamsaraStatus(`Driver responded: "${response}". Updating transport record...`);
            }, 1000);
            
            setTimeout(() => {
                updateSamsaraStatus(`Transport status updated. ${getStatusUpdate(eventType, response)}`);
            }, 2500);
        }

        function getStatusUpdate(eventType, response) {
            const updates = {
                route: "Route confirmed. ETA logged.",
                pickup: "Pickup status updated. On schedule.",
                arrival: "Arrival confirmed. Loading in progress.",
                document: "Document received. POD uploaded to transport record.",
                hos: "HOS status updated. Compliance maintained.",
                geofence: "Activity logged. Duration estimated."
            };
            return updates[eventType] || "Status updated successfully.";
        }

        function updateSamsaraStatus(message) {
            const statusContainer = document.getElementById('samsara-status');
            const statusDiv = document.createElement('div');
            statusDiv.className = 'text-sm text-gray-700 p-2 bg-blue-50 rounded border-l-4 border-blue-400 status-update';
            statusDiv.innerHTML = `<strong>${new Date().toLocaleTimeString()}:</strong> ${message}`;
            
            statusContainer.appendChild(statusDiv);
            
            // Keep only last 5 status messages
            const statusMessages = statusContainer.querySelectorAll('.status-update');
            if (statusMessages.length > 5) {
                statusMessages[0].remove();
            }
        }

        function clearDemo() {
            // Clear WhatsApp messages
            document.getElementById('whatsapp-messages').innerHTML = `
                <div class="text-center text-gray-500 text-sm py-8">
                    FleetChat messages will appear here when you trigger Samsara events
                </div>
            `;
            
            // Clear response options
            document.getElementById('response-options').innerHTML = `
                <div class="text-sm text-gray-600">Response options will appear when messages are received</div>
            `;
            
            // Reset Samsara status
            document.getElementById('samsara-status').innerHTML = `
                <div class="text-sm text-gray-600">Ready to process events...</div>
            `;
        }
    </script>
</body>
</html>