<!DOCTYPE html>
<html>
<head>
    <title>FleetChat Demo</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; }
        .header { text-align: center; background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .panels { display: flex; gap: 20px; }
        .panel { flex: 1; background: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .panel-header { padding: 15px; color: white; font-weight: bold; text-align: center; }
        .samsara { background: #1e40af; }
        .whatsapp { background: #059669; }
        .panel-body { padding: 20px; }
        .btn { width: 100%; padding: 12px; margin-bottom: 8px; border: 1px solid #ddd; border-radius: 6px; background: white; cursor: pointer; text-align: left; }
        .btn:hover { background: #f8f9fa; }
        .chat { height: 300px; border: 1px solid #e5e7eb; padding: 15px; background: #f9fafb; overflow-y: auto; margin-bottom: 15px; border-radius: 6px; }
        .message { margin-bottom: 10px; }
        .fleet-message { text-align: right; }
        .driver-message { text-align: left; }
        .bubble { display: inline-block; max-width: 80%; padding: 8px 12px; border-radius: 12px; }
        .fleet-bubble { background: #1e40af; color: white; }
        .driver-bubble { background: white; border: 1px solid #d1d5db; }
        .response-btn { width: 100%; padding: 8px; margin-bottom: 4px; background: #059669; color: white; border: none; border-radius: 4px; cursor: pointer; }
        .response-btn:hover { background: #047857; }
        .status { background: #f3f4f6; padding: 10px; border-radius: 6px; margin-top: 10px; }
        .status-item { font-size: 12px; margin: 3px 0; padding: 4px; background: #dbeafe; border-left: 3px solid #1e40af; }
        .clear { display: block; margin: 20px auto; padding: 10px 20px; background: #6b7280; color: white; border: none; border-radius: 6px; cursor: pointer; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>FleetChat Demo</h1>
            <p>Click events to see WhatsApp communication</p>
        </div>
        
        <div class="panels">
            <div class="panel">
                <div class="panel-header samsara">Samsara Fleet Events</div>
                <div class="panel-body">
                    <button class="btn" data-event="route">
                        <strong>üöö Route Assignment</strong><br>
                        <small>New delivery route assigned</small>
                    </button>
                    <button class="btn" data-event="pickup">
                        <strong>üìã Pickup Reminder</strong><br>
                        <small>Pickup time approaching</small>
                    </button>
                    <button class="btn" data-event="arrival">
                        <strong>üìç Arrival</strong><br>
                        <small>Driver arrived at location</small>
                    </button>
                    
                    <div class="status">
                        <strong>Status:</strong>
                        <div id="status-log">
                            <div class="status-item">Ready...</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="panel">
                <div class="panel-header whatsapp">WhatsApp Driver Interface</div>
                <div class="panel-body">
                    <div class="chat" id="chat">
                        <div style="text-align: center; color: #6b7280; padding: 60px 0;">
                            Click an event to start
                        </div>
                    </div>
                    
                    <div>
                        <strong>Responses:</strong>
                        <div id="responses">
                            <div style="color: #6b7280;">Options appear with messages</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <button class="clear" onclick="resetDemo()">Reset Demo</button>
    </div>

    <script>
        console.log('Starting FleetChat Demo');
        
        const events = {
            route: {
                message: "New route: ACME Corp, 123 Industrial Blvd, Chicago IL. Please confirm receipt.",
                responses: ["Confirm Route", "Need Help", "Delay Expected"]
            },
            pickup: {
                message: "Pickup reminder: ACME Corp in 30 minutes. Any issues?",
                responses: ["On My Way", "Need Directions", "Running Late"]
            },
            arrival: {
                message: "Arrived at ACME Corp. Please update loading status.",
                responses: ["Loading Started", "Share Location", "Issues Found"]
            }
        };
        
        let messageCount = 0;
        
        // Add click handlers
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, adding event listeners');
            
            const buttons = document.querySelectorAll('[data-event]');
            buttons.forEach(function(button) {
                button.addEventListener('click', function() {
                    const eventType = this.getAttribute('data-event');
                    handleEvent(eventType);
                });
            });
        });
        
        function handleEvent(type) {
            console.log('Event triggered:', type);
            
            const event = events[type];
            if (!event) {
                console.error('Unknown event:', type);
                return;
            }
            
            addStatus('Processing ' + type + ' event...');
            
            setTimeout(function() {
                showTyping();
            }, 500);
            
            setTimeout(function() {
                hideTyping();
                addMessage(event.message, 'fleet');
                showResponseOptions(event.responses);
                addStatus('Message sent to driver');
            }, 2000);
        }
        
        function addMessage(text, sender) {
            const chat = document.getElementById('chat');
            
            if (messageCount === 0) {
                chat.innerHTML = '';
            }
            messageCount++;
            
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message ' + (sender === 'fleet' ? 'fleet-message' : 'driver-message');
            
            const bubbleDiv = document.createElement('div');
            bubbleDiv.className = 'bubble ' + (sender === 'fleet' ? 'fleet-bubble' : 'driver-bubble');
            bubbleDiv.textContent = text;
            
            messageDiv.appendChild(bubbleDiv);
            chat.appendChild(messageDiv);
            chat.scrollTop = chat.scrollHeight;
        }
        
        function showTyping() {
            const chat = document.getElementById('chat');
            const typingDiv = document.createElement('div');
            typingDiv.id = 'typing-indicator';
            typingDiv.className = 'message driver-message';
            typingDiv.innerHTML = '<div class="bubble driver-bubble">Typing...</div>';
            chat.appendChild(typingDiv);
            chat.scrollTop = chat.scrollHeight;
        }
        
        function hideTyping() {
            const typing = document.getElementById('typing-indicator');
            if (typing) {
                typing.remove();
            }
        }
        
        function showResponseOptions(options) {
            const responsesDiv = document.getElementById('responses');
            responsesDiv.innerHTML = '';
            
            options.forEach(function(option) {
                const button = document.createElement('button');
                button.className = 'response-btn';
                button.textContent = option;
                button.addEventListener('click', function() {
                    sendResponse(option);
                });
                responsesDiv.appendChild(button);
            });
        }
        
        function sendResponse(response) {
            console.log('Driver response:', response);
            
            addMessage(response, 'driver');
            document.getElementById('responses').innerHTML = '<div style="color: #059669;">‚úì Response sent</div>';
            
            setTimeout(function() {
                addStatus('Driver responded: "' + response + '"');
            }, 800);
            
            setTimeout(function() {
                addStatus('Status updated in Samsara');
            }, 1500);
        }
        
        function addStatus(message) {
            const statusLog = document.getElementById('status-log');
            const statusDiv = document.createElement('div');
            statusDiv.className = 'status-item';
            statusDiv.innerHTML = new Date().toLocaleTimeString() + ': ' + message;
            
            statusLog.appendChild(statusDiv);
            
            // Keep last 4 items
            const items = statusLog.querySelectorAll('.status-item');
            if (items.length > 4) {
                items[0].remove();
            }
        }
        
        function resetDemo() {
            console.log('Resetting demo');
            
            document.getElementById('chat').innerHTML = 
                '<div style="text-align: center; color: #6b7280; padding: 60px 0;">Click an event to start</div>';
            
            document.getElementById('responses').innerHTML = 
                '<div style="color: #6b7280;">Options appear with messages</div>';
            
            document.getElementById('status-log').innerHTML = 
                '<div class="status-item">Ready...</div>';
            
            messageCount = 0;
        }
        
        console.log('FleetChat Demo ready');
    </script>
</body>
</html>